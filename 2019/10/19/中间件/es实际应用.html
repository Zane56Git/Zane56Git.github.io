<hr>
<p>title: es实际应用<br>tags:</p>
<ul>
<li>大数据</li>
<li>elasticsearch<br>categories:</li>
<li>大数据<br>toc: true<br>date: 2018/1/19 0:18:18</li>
</ul>
<hr>
<p>es<br>面向文档，文档是所有可搜索的数据最小单位<br>可以理解为一个文件、日志、mp3歌曲信息等等</p>
<p>文档会被序列号成json格式保存在es中</p>
<p>es和solr都是基于hahhop之父1999年开发的lucene开源项目<br>es：<br>支持分布式、水平扩展<br>降低全文检索学习曲线</p>
<h2 id="本地安装及水平扩展"><a href="#本地安装及水平扩展" class="headerlink" title="本地安装及水平扩展"></a>本地安装及水平扩展</h2><p>7.0已内置jdk</p>
<p>阿里云es30免费试用版</p>
<p>es实际应用</p>
<p>目前只是记录一下es的简单使用<br>使用es查看日志，首先得有关联的索引</p>
<p>通过筛选查看数据<br>例如</p>
<p>(模糊并查询)</p>
<p>条件 and flag_name and 13800138000</p>
<h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><p>文档</p>
<p>节点（Data Node、Coordinating Node），还有其他节点类型</p>
<p>分片（主分片、副本）<br>分片的设定（创建索引时会设置主分片，需提前容量规划）<br>多或少都有影响</p>
<p>查看健康情况</p>
<h2 id="可视化工具"><a href="#可视化工具" class="headerlink" title="可视化工具"></a>可视化工具</h2><p>##项目实战</p>
<p>快速定位日志</p>
<p>索引-&gt;（日志字段筛选，例如：message:”查询关键字1” and message:”查询关键字2”）</p>
<h2 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h2><p> java.util.LinkedHashMap cannot be cast to XXXX</p>
<p> 先转成MAP 在转成JSON  在转成JavaBean </p>
<p> 后面修改方法：先转成LinkedHashMap 再转成json最后转成json</p>
<p>LinkedHashMap linkedHashMap = (LinkedHashMap) map.get(“data”);</p>
<p>String json = new JSONObject().toJSONString(linkedHashMap);</p>
<p>userEntity = new JSONObject().parseObject(json, UserEntity.class);<br>————————————————<br>版权声明：本文为CSDN博主「BellCalderon」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/u014373554/article/details/92743743">https://blog.csdn.net/u014373554/article/details/92743743</a></p>
<pre><code class="shell">Get 查看所有索引

localhost:9200/_all

PUT 创建索引-test

localhost:9200/test  


DEL 删除索引-test

localhost:9200/test  


PUT 创建索引-person-1

localhost:9200/person


PUT 新增数据-person-1

localhost:9200/person/_doc/1

{
    &quot;first_name&quot; : &quot;John&quot;,
  &quot;last_name&quot; : &quot;Smith&quot;,
  &quot;age&quot; : 25,
  &quot;about&quot; : &quot;I love to go rock climbing&quot;,
  &quot;interests&quot; : [ &quot;sports&quot;, &quot;music&quot; ]
}

PUT 新增数据-person-2

localhost:9200/person/_doc/2

{
    &quot;first_name&quot; : &quot;Eric&quot;,
  &quot;last_name&quot; : &quot;Smith&quot;,
  &quot;age&quot; : 23,
  &quot;about&quot; : &quot;I love basketball&quot;,
  &quot;interests&quot; : [ &quot;sports&quot;, &quot;reading&quot; ]
}

GET 搜索数据-person-id

localhost:9200/person/_doc/1

GET 搜索数据-person-name

localhost:9200/person/_doc/_search?q=first_name:john

{
  &quot;took&quot;: 56,
  &quot;timed_out&quot;: false,
  &quot;_shards&quot;: {
    &quot;total&quot;: 1,
    &quot;successful&quot;: 1,
    &quot;skipped&quot;: 0,
    &quot;failed&quot;: 0
  },
  &quot;hits&quot;: {
    &quot;total&quot;: {
      &quot;value&quot;: 1,
      &quot;relation&quot;: &quot;eq&quot;
    },
    &quot;max_score&quot;: 0.6931472,
    &quot;hits&quot;: [
      {
        &quot;_index&quot;: &quot;person&quot;,
        &quot;_type&quot;: &quot;_doc&quot;,
        &quot;_id&quot;: &quot;1&quot;,
        &quot;_score&quot;: 0.6931472,
        &quot;_source&quot;: {
          &quot;first_name&quot;: &quot;John&quot;,
          &quot;last_name&quot;: &quot;Smith&quot;,
          &quot;age&quot;: 25,
          &quot;about&quot;: &quot;I love to go rock climbing&quot;,
          &quot;interests&quot;: [
            &quot;sports&quot;,
            &quot;music&quot;
          ]
        }
      }
    ]
  }
}
</code></pre>
<h1 id="温馨提示"><a href="#温馨提示" class="headerlink" title="温馨提示"></a>温馨提示</h1><p>有相关可视化工具</p>
<p>es本身也是一个数据库，可以通过DBeaver进行连接，默认安装是没有密码的</p>
<p>通过 dbeaver 配置 jdbc 连接 es时报错 current license is non-compliant for [jdbc]</p>
<p>在官网 <a href="https://www.elastic.co/cn/subscriptions">https://www.elastic.co/cn/subscriptions</a> 搜索后发现需要白金级别</p>
<p>查看服务器es的license信息，发现 “type” : “basic”</p>
<pre><code># curl -XGET http://localhost:9200/_license
</code></pre>
<p>修改成30天试用版，<a href="https://www.elastic.co/guide/en/elasticsearch/reference/master/start-trial.html">https://www.elastic.co/guide/en/elasticsearch/reference/master/start-trial.html</a></p>
<pre><code># curl -X POST &quot;localhost:9200/_license/start_trial?acknowledge=true&amp;pretty&quot;
{
  &quot;acknowledged&quot; : true,
  &quot;trial_was_started&quot; : true,
  &quot;type&quot; : &quot;trial&quot;
}

</code></pre>
<p>感谢&amp;参考：<a href="https://www.freesion.com/article/9255676433/">https://www.freesion.com/article/9255676433/</a></p>
